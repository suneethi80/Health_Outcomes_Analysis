---
title: "midstone_sunee"
author: "Suneethi"
date: "1/2/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(tidyverse)
library(readxl)
install.packages(c("maps", "mapdata"))
library(maps)
library(forcats)
library(ggplot2)


```

Read the csv file- tn 2019 county health rankings
```{r}
tn_2019<-read_excel('data/2019 County Health Rankings Tennessee Data - v1_0.xls', 4, skip=1)
```

take a glimpse and remove unncessary columns

```{r}
glimpse(tn_2019)
```
#select specific columns from tn_2019_msrs
```{r}

tn_2019_msrs<-tn_2019 %>% 
  select(FIPS, State, County, `Years of Potential Life Lost Rate`, `YPLL Rate (Black)`, `YPLL Rate (Hispanic)`, `YPLL Rate (White)`, `% Fair/Poor`, `Physically Unhealthy Days`, `Mentally Unhealthy Days`, `% LBW`, `% LBW (Black)`, `% LBW (Hispanic)`, `% LBW (White)`, `% Smokers`, `% Obese`, `Food Environment Index`, `% Physically Inactive`, `% With Access`, `% Excessive Drinking`, `# Alcohol-Impaired Driving Deaths`, `# Driving Deaths`, `% Alcohol-Impaired`, `# Chlamydia Cases`, `Chlamydia Rate`, `Teen Birth Rate`, `Teen Birth Rate (Black)`, `Teen Birth Rate (Hispanic)`, `Teen Birth Rate (White)`, `# Uninsured`, `% Uninsured`, `# Primary Care Physicians`, `PCP Rate`, `PCP Ratio`, `# Dentists`, `Dentist Rate`, `Dentist Ratio`, `# Mental Health Providers`, `MHP Rate`, `MHP Ratio`, `Preventable Hosp. Rate`, `Preventable Hosp. Rate (Black)`, `Preventable Hosp. Rate (Hispanic)`, `Preventable Hosp. Rate (White)`, `% Screened`, `% Screened (Black)`, `% Screened (Hispanic)`, `% Screened (White)`, `% Vaccinated`, `% Vaccinated (Black)`, `% Vaccinated (Hispanic)`, `% Vaccinated (White)`, `Cohort Size`, `Graduation Rate`, `# Some College`, Population, `% Some College`, `# Unemployed`, `Labor Force`, `% Unemployed`, `% Children in Poverty`, `% Children in Poverty (Black)`, `% Children in Poverty (Hispanic)`, `% Children in Poverty (White)`, `80th Percentile Income`, `20th Percentile Income`, `Income Ratio`, `# Single-Parent Households`, `# Households`, `% Single-Parent Households`, `# Associations`, `Association Rate`, `Annual Average Violent Crimes`, `Violent Crime Rate`, `# Injury Deaths`, `Injury Death Rate`, `Average Daily PM2.5`, `Presence of violation`, `% Severe Housing Problems`, `Severe Housing Cost Burden`, Overcrowding, `Inadequate Facilities`, `% Drive Alone`, `% Drive Alone (Black)`, `% Drive Alone (Hispanic)`, `% Drive Alone (White)`, `# Workers who Drive Alone`, `% Long Commute - Drives Alone`)
```

Rename some columns in tn_2019msrs
```{r}
tn_2019_msrs<-tn_2019_msrs %>% 
  rename(pct_fair_poor_health = `% Fair/Poor`, pct_exercise_access =`% With Access`, pct_mammography_screen =`% Screened`, pct_mammo_screend_blk = `% Screened (Black)`, pct_mammo_screend_hisp = `% Screened (Hispanic)`, pct_mammo_screend_white = `% Screened (White)`, pct_flu_vaccintd = `% Vaccinated`, pct_flu_vaccintd_blk = `% Vaccinated (Black)`, pct_flu_vaccintd_hisp = `% Vaccinated (Hispanic)`, pct_flu_vaccintd_white = `% Vaccinated (White)`, cohort_grad_size = `Cohort Size`, college_25to44age = `# Some College`)
```


Plots:
1) Counties with lowest birth weight?
2)correlation between teen births and low birth weight
3)distribution of uninsured population
4)county with highest or lowest uninsured population
5)correlation between income and uninsured?
6) use additional health measures data for demographics data and for uninsured adults vs children

low birth weight distribution:
```{r}
tn_2019_msrs %>% 
  ggplot(aes(x=`% LBW`)) +
  geom_histogram(bins=10, fill="skyblue")
```
most of low birth weight between 8-10
Counties with lowest birth weight:
```{r}
tn_2019_msrs %>% 
  arrange(`% LBW`) %>% 
  top_n(5, `% LBW`) %>% 
  ggplot(aes(x=County, y=`% LBW`)) +
  geom_col()
```


#read in the additional measure sheet that has demographics data
```{r}
tn_2019_addn<-read_excel('data/2019 County Health Rankings Tennessee Data - v1_0.xls', 5, skip=1)
```

# Glimpse of additional measures dataset and select specific columns

```{r}
tn_2019_addn<-tn_2019_addn %>% 
   select(FIPS, State, County, `Life Expectancy`, `Life Expectancy (Black)`, `Life Expectancy (Hispanic)`, `Life Expectancy (White)`, `# Deaths...10`, `Age-Adjusted Mortality`, `Age-Adjusted Mortality (Black)`, `Age-Adjusted Mortality (Hispanic)`, `Age-Adjusted Mortality (White)`, `# Deaths...17`, `Child Mortality Rate`, `Child Mortality Rate (Black)`, `Child Mortality Rate (Hispanic)`, `Child Mortality Rate (White)`, `# Deaths...24`, `Infant Mortality Rate`, `Infant Mortality Rate (Black)`, `Infant Mortality Rate (Hispanic)`, `Infant Mortality Rate (White)`, `% Frequent Physical Distress`, `% Frequent Mental Distress`, `% Diabetic`, `# HIV Cases`, `HIV Prevalence Rate`, `# Food Insecure`, `% Food Insecure`, `# Limited Access`, `% Limited Access`, `# Drug Overdose Deaths`, `Drug Overdose Mortality Rate`, `# Motor Vehicle Deaths`, `MV Mortality Rate`, `% Insufficient Sleep`, `# Uninsured...55`, `% Uninsured...56`, `# Uninsured...59`, `% Uninsured...60`, `Other PCP Rate`, `Other PCP Ratio`, `% Disconnected Youth`, `Household Income`, `Household income (Black)`, `Household income (Hispanic)`, `Household income (White)`, `Segregation index`, `Segregation Index`, `Homicide Rate`, `# Firearm Fatalities`, `Firearm Fatalities Rate`, `# Homeowners`, `% Homeowners`, `# Households with Severe Cost Burden`, Population, `% Severe Housing Cost Burden`, Population, `% < 18`, `% 65 and over`, `# African American`, `% African American`, `# American Indian/Alaskan Native`, `% American Indian/Alaskan Native`, `# Asian`, `% Asian`, `# Native Hawaiian/Other Pacific Islander`, `% Native Hawaiian/Other Pacific Islander`, `# Hispanic`, `% Hispanic`, `# Non-Hispanic White`, `% Non-Hispanic White`, `# Not Proficient in English`, `% Not Proficient in English`, `% Female`, `# Rural`, `% Rural`)
```

```{r}
glimpse(tn_2019_addn)
```

plotting demographics
```{r}
tn_2019_addn %>%
   filter(FIPS!=47000) %>% 
   ggplot(aes(x=Population)) + geom_histogram(bins=20) 
```

demographics only dataset taken from orginal addtal measures data
included in demographics - population, population based on age, race and sex and rural, homeowners, household income
```{r}
demo_tn_2019<- tn_2019_addn %>% 
  select(FIPS, State, County, `Household Income`, `Household income (Black)`, `Household income (Hispanic)`, `Household income (White)`, `Segregation index`, `Segregation Index`, `# Homeowners`, `% Homeowners`, `# Households with Severe Cost Burden`, Population, `% Severe Housing Cost Burden`, Population, `% < 18`, `% 65 and over`, `# African American`, `% African American`, `# American Indian/Alaskan Native`, `% American Indian/Alaskan Native`, `# Asian`, `% Asian`, `# Native Hawaiian/Other Pacific Islander`, `% Native Hawaiian/Other Pacific Islander`, `# Hispanic`, `% Hispanic`, `# Non-Hispanic White`, `% Non-Hispanic White`, `# Not Proficient in English`, `% Not Proficient in English`, `% Female`, `# Rural`, `% Rural`)
```

```{r}
demo_tn_2019 %>% 
  arrange(`Household Income`) %>% 
  mutate(County= fct_reorder(County, `Household Income`)) %>% 
  top_n(10, `Household Income`) %>% 
  ggplot(aes(x=County, y=`Household Income`)) +
  geom_point(color="blue", size=4, alpha=0.6) +
  geom_segment(aes(x=County, xend=County, y=0, yend=`Household Income`), color="skyblue")+
  labs(title="Top 10 Counties with Highest Income")+
  theme_light() +
  coord_flip() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank(),
    text = element_text(size=15)
  )
```

```{r}
demo_tn_2019 %>% 
  arrange(`Household Income`) %>% 
  mutate(County= fct_reorder(County, `Household Income`)) %>% 
  top_n(-10, `Household Income`) %>% 
  ggplot(aes(x=County, y=`Household Income`)) +
  geom_point(color="blue", size=4, alpha=0.6) +
  geom_segment(aes(x=County, xend=County, y=0, yend=`Household Income`), color="skyblue")+
  theme_light() +
  coord_flip() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.border = element_blank(),
    axis.ticks.y = element_blank(),
    text = element_text(size=15)
  )
```

tn map showing population and income
```{r}
states <- map_data("state")
tn<-subset(states, region %in% c("tennessee"))
ggplot(data = tn) + 
  geom_polygon(aes(x = long, y = lat), fill = "palegreen", color = "black") +
  coord_fixed(1.3)
tn_df<-subset(states, region=="tennessee")
counties<-map_data("county")
tn_county<-subset(counties, region=="tennessee")
tn_base <- ggplot(data = tn_df, mapping = aes(x = long, y = lat, group = group)) + 
  coord_fixed(1.3) + 
  geom_polygon(color = "black", fill = "gray")
tn_base +  
  geom_polygon(data = tn_county, fill = NA, color = "white") +
  geom_polygon(color = "black", fill = NA)  

  
```

```{r}
head(tn_county)
tn_county<-tn_county %>% 
  rename(County=subregion, State=region)
head(tn_county)
```


```{r}
demo_tn_pops<-demo_tn_2019 %>% 
  select(State, County, Population) 
demo_tn_pops$County<-tolower(demo_tn_pops$County)
head(demo_tn_pops)
names(demo_tn_pops)<-c("State", "County", "Population")
demo_tn_pops$Population <- as.numeric(demo_tn_pops$Population)
head(demo_tn_pops)

```

```{r}
ditch_the_axes <- theme(
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank())
tncopa <- inner_join(tn_county, demo_tn_pops, by = "County")
elb<-tn_base + 
      geom_polygon(data = tncopa, aes(fill = Population), color = "white") +
      geom_polygon(color = "black", fill = NA) +
    theme_bw() +
      ditch_the_axes 
elb
elb + 
    scale_fill_gradientn(colours = rev(rainbow(7)),
                         breaks = c(10000, 30000, 100000, 300000, 700000),
                         trans = "log10")


```


For shinyapp:
compare between states using data reported within the same years. 
Note- Years reported are not the same as data reported in same year,
example- 2019 tn report does not mean infant mortality is reported for 2019. its a span of years or not a span. 
it is possible to compare between years but it wont be year by year comparison ust 
## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
usa <- map_data("usa") # we already did this, but we can do it again
ggplot() + geom_polygon(data = usa, aes(x=long, y = lat, group = group)) + 
  coord_fixed(1.3)
```

```{r}
states <- map_data("state")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

#Saving as RDS file as input for shinyapps
```{r}
saveRDS(tn_2019_msrs, file = "tn_2019.RDS")
```

